@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Lato:wght@400;700&display=swap');

:root {
  --bg-dark: #0a0a0c;
  --panel-bg: #15151a;
  --arcana-purple: #9c27b0;
  --arcana-glow: #e040fb;
  --gold: #c5a059;
  --gold-dim: #8d7032;
  --card-bg: #1e1e24;
  --text-main: #e0e0e0;
  --font-title: 'Cinzel', serif;
  --font-body: 'Lato', sans-serif;
  --panel-height: 180px; /* Tinggi area kartu */
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background: #000;
  font-family: var(--font-body);
  color: var(--text-main);
  height: 100dvh;
  overflow: hidden;
  user-select: none;
}

#game-viewport { 
  width: 100%; 
  max-width: 450px; /* Mode Portrait Mobile */
  height: 100%;
  margin: 0 auto; /* Center di desktop */
  position: relative;
  display: flex;
  flex-direction: column;
  background: var(--bg-dark);
  border-left: 2px solid #222;
  border-right: 2px solid #222;
  overflow: hidden;
}

/* --- CANVAS LAYER --- */
#canvas-container {
  position: relative;
  flex: none; /* Matikan flex grow */
  width: 100%;
  height: calc(100% - var(--panel-height)); /* Tinggi Layar - Tinggi Panel */
  overflow: hidden;
  background: #111;
  z-index: 1;
}

canvas {
  display: block;
  width: 100%;
  height: 100%;
}

/* --- UI OVERLAY LAYER --- */
#game-ui {
  position: absolute; /* Overlay di atas canvas */
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* Biar tembus ke canvas */
  z-index: 50;
}

/* PANEL ANIMASI (Curtain Effect) */
#bottom-panel {
  position: absolute;
  top: 0; 
  left: 0;
  width: 100%;
  height: 100%; /* Menutupi seluruh layar secara default */
  
  background: linear-gradient(180deg, #1a1a20 0%, #0a0a0c 100%);
  border-top: 4px solid var(--gold-dim);
  box-shadow: 0 -10px 40px rgba(0,0,0,0.8);
  
  /* Animasi Naik Turun */
  transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);
  transform: translateY(0); /* Default: Menutup (Loading/Game Over) */
  pointer-events: auto; /* Bisa diklik */
  
  display: flex;
  flex-direction: column;
}

/* STATE: IN-GAME (Panel Turun) */
/* Kita geser panel ke bawah, sisakan 220px (panel-height) di layar */
#bottom-panel.panel-in-game {
  transform: translateY(calc(100% - var(--panel-height)));
}

/* --- GAME HUD (Cards & Arcana) --- */
#game-hud {
  position: absolute;
  top: 0; /* [FIX PENTING] Tempel di ATAS panel agar terlihat saat panel turun */
  left: 0;
  width: 100%;
  height: var(--panel-height);
  
  /* Fade Out saat Loading/Game Over */
  opacity: 1;
  transition: opacity 0.3s;
}

/* Sembunyikan kartu jika panel menutup layar (Loading/GameOver) */
#bottom-panel:not(.panel-in-game) #game-hud {
  opacity: 0;
  pointer-events: none;
}

/* --- GAME OVER SCREEN --- */
#game-over-screen {
  position: absolute;
  top: 45%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  width: 100%;
  z-index: 100;
  opacity: 1;
  transition: opacity 0.5s 0.3s; /* Delay dikit */
}

#game-over-screen.hidden {
  opacity: 0;
  pointer-events: none;
}

#go-title {
  font-family: var(--font-title);
  font-size: 42px;
  margin: 0;
  text-shadow: 0 0 20px rgba(0,0,0,0.8);
}

#go-message { color: #aaa; margin-bottom: 30px; font-size: 14px; }

.go-buttons button {
  background: var(--card-bg);
  border: 1px solid var(--gold);
  color: var(--gold);
  padding: 12px 24px;
  font-family: var(--font-title);
  font-size: 14px;
  cursor: pointer;
  margin: 0 8px;
  transition: all 0.2s;
  text-transform: uppercase;
}
.go-buttons button:hover {
  background: var(--gold);
  color: #000;
}

/* --- ARCANA BAR --- */
#info-row { 
  display: flex; justify-content: center; 
  padding-top: 0px;
  width: 100%;
}

#elixir-area { 
  display: flex; align-items: center; gap: 10px; 
}

.elixir-bar-bg {
  width: 200px; height: 10px; 
  background: #000; border: 1px solid #333; border-radius: 5px;
  overflow: hidden;
}

#elixir-fill {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, #7b1fa2, #e040fb);
  box-shadow: 0 0 10px var(--arcana-glow);
  transition: width 0.1s linear;
}

#elixir-text {
  font-family: var(--font-title); font-size: 18px; 
  color: var(--arcana-glow); font-weight: bold;
}

/* --- HAND CARDS --- */
#hand-cards {
  position: relative;
  width: 100%;
  height: 100%;
  margin-top: 10px;
  perspective: 800px;
}

.hand-card {
  position: absolute;
  width: 80px; height: 120px;
  left: 50%; bottom:70px; /* Posisi standar */
  background: var(--card-bg);
  border: 2px solid var(--gold-dim);
  border-radius: 6px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  
  transform-origin: center 150%;
  transform: translateX(calc(-50% + var(--x))) rotate(var(--rot)) translateY(var(--y));
  transition: transform 0.2s, border-color 0.2s, opacity 0.2s; /* [FIX] Tambah opacity transition */
  cursor: pointer;

  touch-action: none; 
  user-select: none;
}

/* [FIX] Hover: Straighten card and lift slightly */
.hand-card:hover {
  z-index: 100;
  border-color: var(--gold);
  /* Lift less aggressively */
  transform: translateX(calc(-50% + var(--x))) translateY(-25px) rotate(0deg) scale(1.1);
  transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
}

/* [NEW] Dragging State */
.hand-card.dragging {
  transition: transform 0s !important; 
  z-index: 1000 !important;
  pointer-events: none; 
}

/* [FIX] Active: Straighten and lift slightly higher */
.hand-card.active {
  z-index: 90;
  border-color: var(--arcana-glow);
  box-shadow: 0 0 20px var(--arcana-purple);
  transform: translateX(calc(-50% + var(--x))) translateY(-40px) rotate(0deg) scale(1.1);
}

.hand-card.active.disabled {
  border-color: #555 !important;
  box-shadow: none !important;
  filter: grayscale(1) brightness(0.8);
  transform: translateX(calc(-50% + var(--x))) translateY(-40px) rotate(0deg) scale(1.1);
}

.hand-card.disabled {
  filter: grayscale(1);
}

.hand-card.disabled .card-cost {
  color: #ff4444; 
  text-shadow: 0 0 2px black;
}

.card-cost {
  position: absolute; top: 4px; right: 6px;
  color: var(--arcana-glow); font-weight: bold; font-family: var(--font-title);
}
.card-name {
  position: absolute; bottom: 6px;
  font-size: 9px; color: var(--gold); text-align: center; width: 100%;
  font-family: var(--font-title); text-transform: uppercase;
}
.card-type {
  font-size: 8px; color: #666; writing-mode: vertical-rl;
  position: absolute; left: 4px; top: 10px; bottom: 10px;
}

/* [NEW] Deploy Animation (Terbang ke atas & Fade out) */
@keyframes deploy-anim {
  0% { transform: translateX(-50%) translateY(-40px) scale(1.2); opacity: 1; }
  100% { transform: translateX(-50%) translateY(-150px) scale(0.8); opacity: 0; }
}
.hand-card.deploying {
  animation: deploy-anim 0.4s forwards ease-out;
  pointer-events: none;
}

/* [NEW] Entering Animation (Masuk dari bawah) */
@keyframes card-enter {
  from { transform: translateX(calc(-50% + var(--x))) translateY(100px) rotate(0deg); opacity: 0; }
  to { opacity: 1; }
}
.hand-card.entering {
  animation: card-enter 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

/* --- ANIMATION --- */
@keyframes shake-cost {
  0%, 100% { transform: translateX(0); color: var(--arcana-glow); }
  50% { transform: translateX(-2px); color: red; }
}
.shake-cost { animation: shake-cost 0.2s; }

/* --- RESPONSIVE MOBILE --- */
@media (max-width: 480px) {
  :root { --panel-height: 190px; }
  
  .hand-card { width: 65px; height: 100px; bottom: 85px; }
  .elixir-bar-bg { width: 140px; }
  #go-title { font-size: 32px; }
}

#card-info-popup {
  position: absolute;
  bottom: 240px; /* Di atas tangan */
  left: 50%;
  transform: translateX(-50%) scale(0.8);
  width: 90%;
  max-width: 300px;
  
  background: rgba(20, 20, 25, 0.95);
  border: 2px solid var(--gold);
  border-radius: 8px;
  padding: 15px;
  
  display: flex;
  flex-direction: column;
  gap: 5px;
  
  box-shadow: 0 0 30px rgba(0,0,0,0.8);
  opacity: 0;
  pointer-events: none; /* Biar tidak mengganggu drag */
  z-index: 200;
  transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

#card-info-popup.visible {
  opacity: 1;
  transform: translateX(-50%) scale(1);
}

.info-title {
  font-family: var(--font-title);
  color: var(--gold);
  font-size: 18px;
  border-bottom: 1px solid #444;
  padding-bottom: 5px;
  margin-bottom: 5px;
}

.info-desc {
  font-size: 12px;
  color: #bbb;
  font-style: italic;
  margin-bottom: 10px;
}

.info-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 5px;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: #fff;
  border-bottom: 1px solid #333;
  padding: 2px 0;
}
.stat-label { color: #888; }

/* ... css sebelumnya ... */

#rematch-status {
  font-family: var(--font-title);
  font-size: 16px;
  color: #fff;
  margin-top: 15px;
  letter-spacing: 1px;
  animation: pulse-text 1.5s infinite;
}

#rematch-status.hidden {
  display: none;
}

@keyframes pulse-text {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; text-shadow: 0 0 10px var(--arcana-glow); }
}

/* Biar tombol rematch visualnya disable kalau sudah diklik */
button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  filter: grayscale(1);
}

/* ... css lainnya ... */

/* --- TOAST NOTIFICATIONS --- */
#toast-container {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 1000;
  pointer-events: none; /* Biar tembus klik ke game */
}

.toast {
  background: rgba(15, 15, 20, 0.95);
  color: #fff;
  padding: 12px 20px;
  border-radius: 4px;
  border-left: 4px solid var(--gold);
  font-family: var(--font-body);
  font-size: 14px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.5);
  
  opacity: 0;
  transform: translateX(50px);
  animation: toast-in 0.3s forwards;
  pointer-events: auto;
}

.toast.error { border-left-color: #ff4444; }
.toast.success { border-left-color: #00C851; }

@keyframes toast-in {
  to { opacity: 1; transform: translateX(0); }
}

@keyframes toast-out {
  to { opacity: 0; transform: translateX(50px); }
}

/* --- SPECTATOR JOIN BUTTON --- */
.spectator-join-btn {
  background: var(--gold);
  color: #000;
  border: none;
  padding: 10px 20px;
  font-family: var(--font-title);
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
  border-radius: 4px;
  box-shadow: 0 0 10px var(--gold-dim);
  transition: all 0.2s;
  pointer-events: auto; /* Penting karena panel spectator biasanya pointer-events: none */
}

.spectator-join-btn:hover {
  background: #fff;
  transform: scale(1.05);
}

.spectator-hud-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
  width: 100%;
}

.spectator-status-text {
  color: #aaa;
  font-size: 14px;
  font-style: italic;
}

#pause-overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.85); /* Gelap Transparan */
  z-index: 2000; /* Di atas segalanya */
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(5px);
  transition: opacity 0.3s;
}

#pause-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}

.pause-content {
  text-align: center;
  color: #fff;
  border: 2px solid var(--gold);
  background: var(--panel-bg);
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 0 50px rgba(0,0,0,1);
  min-width: 300px;
}

.pause-content h1 {
  font-family: var(--font-title);
  color: var(--gold);
  margin: 0 0 10px 0;
  font-size: 32px;
  letter-spacing: 2px;
}

#pause-reason {
  color: #ccc;
  font-size: 16px;
  margin-bottom: 20px;
  font-style: italic;
}

/* Timer Circle */
.timer-ring {
  width: 80px; height: 80px;
  border: 4px solid #333;
  border-top-color: var(--gold);
  border-radius: 50%;
  margin: 0 auto 20px auto;
  display: flex;
  align-items: center;
  justify-content: center;
  animation: spin-timer 1s linear infinite; /* Putar visual ring */
}

#pause-timer {
  font-family: var(--font-title);
  font-size: 32px;
  font-weight: bold;
  color: #fff;
  animation: none; /* Angka jangan ikut muter */
  /* Counter-rotate agar angka tetap tegak saat ring berputar (Trick) 
     ATAU hapus animasi spin di parent jika ingin statis. 
     Untuk simpel, kita hapus animasi spin di parent dan buat border statis saja 
     atau pakai SVG. Kita pakai statis saja biar mudah dibaca. */
}
.timer-ring { animation: none; border-color: var(--gold); }

.pause-subtext {
  font-size: 12px;
  color: #666;
  margin: 0;
}

/* --- OMEN OVERLAY --- */
#omen-overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.9);
  z-index: 3000;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 2s ease-in-out;
}

#omen-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

.omen-content {
  text-align: center;
  color: #fff;
  animation: float-omen 4s ease-in-out infinite;
}

#omen-title {
  font-family: var(--font-title);
  font-size: 48px;
  color: #ff3333; /* Default Omen Red */
  text-shadow: 0 0 20px #900;
  margin: 0;
  letter-spacing: 4px;
  opacity: 0;
  transform: translateY(20px);
  animation: fade-up 1s forwards 0.5s;
}

#omen-desc {
  font-family: var(--font-body);
  font-size: 18px;
  color: #ccc;
  margin-top: 10px;
  font-style: italic;
  opacity: 0;
  transform: translateY(20px);
  animation: fade-up 1s forwards 1.0s;
}

@keyframes float-omen {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

@keyframes fade-up {
  to { opacity: 1; transform: translateY(0); }
}

/* --- CARD VISUALS (SHARED) --- */
/* Base Card Style override/mixin logic */
.card-visual {
  background: #1e1e24;
  border: 1px solid #444; 
  border-radius: 6px;
  position: relative;
  overflow: hidden;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
  transition: all 0.2s;
  /* Aspect Ratio ~ Tarot */
}

/* Faction Themes */
.card-solaris {
  border-color: #c5a059;
  box-shadow: 0 0 5px rgba(197, 160, 89, 0.2), inset 0 0 20px rgba(197, 160, 89, 0.1);
  background: linear-gradient(135deg, #1a1a15 0%, #2a2510 100%);
}
.card-noctis {
  border-color: #9c27b0;
  box-shadow: 0 0 5px rgba(156, 39, 176, 0.2), inset 0 0 20px rgba(156, 39, 176, 0.1);
  background: linear-gradient(135deg, #15101a 0%, #25102a 100%);
}
.card-neutral {
  border-color: #777;
  background: linear-gradient(135deg, #222 0%, #333 100%);
}
.card-taboo {
  border-color: #ff0000;
  box-shadow: 0 0 10px rgba(255, 0, 0, 0.4), inset 0 0 30px rgba(100, 0, 0, 0.5);
  background: linear-gradient(135deg, #1a0000 0%, #2d0000 100%);
  animation: taboo-pulse 3s infinite;
}

@keyframes taboo-pulse {
  0%, 100% { border-color: #800000; }
  50% { border-color: #ff0000; }
}

/* Sigils (CSS Shapes/Icons) */
.card-sigil {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  opacity: 0.15;
  pointer-events: none;
  font-size: 30px; /* Fallback text size */
  width: 40px; height: 40px;
  display: flex; align-items: center; justify-content: center;
}

/* Solaris Sun */
.sigil-solaris::before {
  content: "‚òÄ";
  font-size: 40px;
  color: #c5a059;
}

/* Noctis Moon */
.sigil-noctis::before {
  content: "‚òæ";
  font-size: 40px;
  color: #9c27b0;
}

/* Taboo Eye */
.sigil-taboo::before {
  content: "üëÅ";
  font-size: 40px;
  color: #ff0000;
}

/* Neutral Balance */
.sigil-neutral::before {
  content: "‚öñ";
  font-size: 40px;
  color: #888;
}

/* Typography override */
.card-roman-cost {
  position: absolute; top: 3px; left: 50%;
  transform: translateX(-50%);
  font-family: var(--font-title);
  font-size: 14px;
  font-weight: bold;
  color: #fff;
  text-shadow: 0 2px 4px #000;
  z-index: 2;
}
.card-solaris .card-roman-cost { color: #ffe0b2; }
.card-noctis .card-roman-cost { color: #e1bee7; }
.card-taboo .card-roman-cost { color: #ff9999; }

.card-type-indicator {
  position: absolute; top: 4px; left: 4px;
  width: 8px; height: 8px;
  border-radius: 50%;
  box-shadow: 0 0 5px currentColor;
}
.type-unit { background-color: #4caf50; color: #4caf50; } /* Green */
.type-spell { background-color: #2196f3; color: #2196f3; } /* Blue */
.type-building { background-color: #ff9800; color: #ff9800; } /* Orange */

/* --- DECK BUILDER --- */
#deck-builder {
  width: 100%; height: 100%;
  padding: 10px;
  display: flex;
  flex-direction: column;
  color: #fff;
  gap: 10px;
}

.db-top-bar {
  display: flex; flex-direction: column; gap: 8px;
  border-bottom: 1px solid #333;
  padding-bottom: 8px;
}

.db-header-row {
  display: flex; justify-content: space-between; align-items: center;
}

.db-faction-title {
  font-family: var(--font-title);
  font-size: 20px;
  color: var(--gold);
}

.db-controls {
  display: flex; gap: 5px; flex-wrap: wrap;
}

.db-search {
  flex: 1;
  background: #222; border: 1px solid #444;
  color: #fff; padding: 6px;
  font-family: var(--font-body);
  border-radius: 4px;
}

.db-filter-btn {
  background: #333; border: 1px solid #555;
  color: #aaa; padding: 4px 8px;
  font-size: 10px; cursor: pointer;
  border-radius: 4px; text-transform: uppercase;
}
.db-filter-btn.active {
  background: var(--gold-dim);
  color: #fff; border-color: var(--gold);
}

.db-content-area {
  display: flex;
  flex: 1;
  gap: 10px;
  overflow: hidden;
}

/* Available Cards Grid */
.db-grid-container {
  flex: 2;
  overflow-y: auto;
  padding-right: 5px;
}
.db-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
  gap: 8px;
}

/* Selected Deck Sidebar */
.db-deck-sidebar {
  flex: 1;
  background: rgba(0,0,0,0.3);
  border-left: 1px solid #333;
  padding-left: 10px;
  display: flex; flex-direction: column;
  min-width: 100px;
}

.db-deck-list {
  flex: 1;
  overflow-y: auto;
  display: flex; flex-direction: column; gap: 4px;
}

.db-deck-item {
  font-size: 10px;
  padding: 4px;
  background: #222;
  border-left: 2px solid #555;
  cursor: pointer;
  display: flex; justify-content: space-between;
}
.db-deck-item:hover { background: #333; }
.db-deck-item.item-solaris { border-left-color: var(--gold); }
.db-deck-item.item-noctis { border-left-color: var(--arcana-purple); }
.db-deck-item.item-taboo { border-left-color: #ff0000; }

.db-footer {
  border-top: 1px solid #333;
  padding-top: 10px;
  display: flex; justify-content: space-between; align-items: center;
}

.db-card-new {
  /* Inherit shared visual */
  width: 100%; aspect-ratio: 2/3;
  cursor: pointer;
}
.db-card-new:hover {
  transform: scale(1.05);
  z-index: 10;
  border-color: #fff;
}
.db-card-new.dimmed {
  opacity: 0.3; filter: grayscale(1);
}

/* Card Detail Overlay */
#card-detail-overlay {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.85);
  z-index: 4000;
  display: flex; align-items: center; justify-content: center;
  backdrop-filter: blur(5px);
  opacity: 0; pointer-events: none; transition: opacity 0.2s;
}
#card-detail-overlay.visible { opacity: 1; pointer-events: auto; }

.detail-card-view {
  width: 280px;
  background: #15151a;
  border: 2px solid var(--gold);
  border-radius: 8px;
  padding: 20px;
  position: relative;
  box-shadow: 0 0 50px rgba(0,0,0,0.8);
  display: flex; flex-direction: column; gap: 15px;
}

.detail-header {
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid #444;
  padding-bottom: 10px;
}
.detail-title { font-family: var(--font-title); font-size: 20px; color: var(--gold); }
.detail-cost { font-size: 24px; font-weight: bold; color: var(--arcana-glow); }

.detail-type { 
  font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: #888; 
  display: flex; gap: 10px;
}

.detail-stats {
  display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
  background: rgba(0,0,0,0.3); padding: 10px; border-radius: 4px;
}

.detail-desc {
  font-size: 14px; color: #ccc; line-height: 1.4; font-style: italic;
}

.btn-close-detail {
  position: absolute; top: 10px; right: 10px;
  background: none; border: none; color: #666; font-size: 20px; cursor: pointer;
}

/* Override .hand-card to use new logic if classes added */
.hand-card.card-visual {
  width: 80px; height: 120px;
  position: absolute; /* [FIX] Force absolute to maintain fan layout override .card-visual relative */
}

@media (max-width: 480px) {
  .hand-card.card-visual { width: 65px; height: 100px; }
  .db-grid-container { padding-right: 0; }
  .db-deck-sidebar { min-width: 80px; }
}